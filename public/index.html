<script type="module">
  import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-app.js";
  import {
    getFirestore,
    collection,
    addDoc,
    serverTimestamp,
  } from "https://www.gstatic.com/firebasejs/9.6.10/firebase-firestore.js";

  const firebaseConfig = {
    apiKey: "SUA_API_KEY",
    authDomain: "SEU_DOMINIO.firebaseapp.com",
    projectId: "SEU_PROJECT_ID",
    storageBucket: "SEU_BUCKET.appspot.com",
    messagingSenderId: "SEU_SENDER_ID",
    appId: "SEU_APP_ID",
  };

  const app = initializeApp(firebaseConfig);
  const db = getFirestore(app);

  document.getElementById("botaoMusica").addEventListener("click", () => {
    const musica = document.getElementById("musicaFesta");
    musica
      .play()
      .then(() => {
        document.getElementById("botaoMusica").style.display = "none";
      })
      .catch((error) => {
        console.log("Erro ao tocar música:", error);
      });
  });

  async function salvarConfirmacao(nome, resposta) {
    try {
      await addDoc(collection(db, "confirmacoes"), {
        nome,
        presenca: resposta,
        data: serverTimestamp(),
      });

      if (resposta === "sim") {
        alert(`🎉 Obrigado, ${nome}! Sua presença foi confirmada!`);
      } else {
        alert(`😢 Sentiremos sua falta, ${nome}.`);
      }
    } catch (error) {
      console.error("Erro ao salvar:", error);
      alert("❌ Ocorreu um erro ao registrar sua resposta.");
    }
  }

  document.querySelector(".sim").addEventListener("click", () => {
    const nome = document.querySelector("input").value.trim();
    if (!nome) return alert("Por favor, digite seu nome.");
    salvarConfirmacao(nome, "sim");
  });

  document.querySelector(".nao").addEventListener("click", () => {
    const nome = document.querySelector("input").value.trim();
    if (!nome) return alert("Por favor, digite seu nome.");
    salvarConfirmacao(nome, "nao");
  });

  // Service Worker
  if ("serviceWorker" in navigator) {
    navigator.serviceWorker
      .register("service-worker.js")
      .then(() => console.log("Service Worker registrado com sucesso!"))
      .catch((error) =>
        console.log("Erro ao registrar Service Worker:", error)
      );
  }
</script>
